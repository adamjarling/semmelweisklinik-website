---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import LanguagePicker from './LanguagePicker.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: `/${lang}/rooms`, label: t('nav.rooms'), width: '72px' },
  { href: `/${lang}/calendar`, label: t('nav.calendar'), width: '105px' },
  { href: `/${lang}/artists`, label: t('nav.people'), width: '75px' },
  { href: `/${lang}/program`, label: t('nav.program'), width: '100px' },
  { href: `/${lang}/participate`, label: t('nav.participate'), width: '124px' },
];
---

<!-- Image viewer (for artist detail pages) -->
<div class="imageViewerWrapper" style="display: none;">
  <div class="imageViewerContainer">
    <img class="imageViewerImage" alt="Enlarged view" />
  </div>
</div>

<!-- Outer container -->
<div style="display: flex; flex-direction: column; align-items: center; min-height: calc(100vh - 20px); justify-content: flex-start;">
  <!-- Desktop Navbar -->
  <div class="only-desktop">
    <div class="container" style="display: flex; align-items: center; height: 140px;">
      <!-- Logo -->
      <a href={`/${lang}`} style="margin-right: auto; border-bottom: none;">
        <img class="navbar-img" src="/svg/logo.svg" alt="Semmelweisklinik Logo" />
      </a>

      <!-- Links -->
      {navLinks.map((link) => (
        <a class="navbar-item" href={link.href}>
          <h3 style={`width: ${link.width};`}>{link.label}</h3>
        </a>
      ))}

      <!-- Language switcher -->
      <div class="navbar-item" style="display: flex; align-items: center; border-bottom: none;">
        <LanguagePicker currentPath={currentPath} currentLang={lang} />
      </div>
    </div>
  </div>

  <!-- Mobile Navbar -->
  <div class="only-mobile">
    <div class="container" style="display: flex; align-items: center; height: 80px;">
      <!-- Logo -->
      <a href={`/${lang}`} style="display: flex; align-items: center; margin-right: auto; border-bottom: none;">
        <img class="navbar-img" src="/svg/logo.svg" alt="Semmelweisklinik Logo" />
      </a>
      <!-- Burger -->
      <img id="burgerButton" style="height: 18px; cursor: pointer;" src="/svg/burger.svg" alt="Menu" />
    </div>
  </div>

  <!-- Mobile overlay -->
  <div id="mobileNav" class="overlay">
    <!-- Language switcher -->
    <div style="position: absolute; top: 24px; left: 35px; display: flex; flex-direction: row; align-items: start;">
      <LanguagePicker currentPath={currentPath} currentLang={lang} />
    </div>
    <!-- Close overlay button -->
    <div id="closeNavButton" style="position: absolute; top: 22px; right: 27px; cursor: pointer;">
      <img style="height: 36px;" src="/svg/x.svg" alt="Close menu" />
    </div>
    <!-- Nav links -->
    <div style="position: relative; top: 50%; transform: translateY(-50%); align-items: center; padding: 0; display: flex; flex-direction: column; gap: 30px;">
      {navLinks.map((link) => (
        <a class="overlay-item" href={link.href}>
          <h3 style="font-size: 28px; margin-bottom: 0;">{link.label}</h3>
        </a>
      ))}
    </div>
  </div>

  <!-- Page Content Slot -->
  <div style="width: 100%;">
    <slot />
  </div>

<script>
  // Mobile nav functions
  function openNav() {
    const mobileNav = document.getElementById("mobileNav");
    if (mobileNav) {
      mobileNav.style.display = "block";
      document.body.style.overflow = "hidden";
    }
  }

  function closeNav() {
    const mobileNav = document.getElementById("mobileNav");
    if (mobileNav) {
      mobileNav.style.display = "none";
      document.body.style.overflow = "visible";
    }
  }

  // Set up event listeners
  document.getElementById("burgerButton")?.addEventListener("click", openNav);
  document.getElementById("closeNavButton")?.addEventListener("click", closeNav);
</script>
